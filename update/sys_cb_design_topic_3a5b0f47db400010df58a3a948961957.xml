<?xml version="1.0" encoding="UTF-8"?><record_update sys_domain="global" table="sys_cb_design_topic">
    <sys_cb_design_topic action="INSERT_OR_UPDATE">
        <compiled_topic display_value="Get Password Reset Link">fa5b0f47db400010df58a3a948961954</compiled_topic>
        <design_definition>{"type":"FlowTopic","triggers":[{"type":"Trigger","name":"475a0f53f68c4332bbaed14f67f5fea1","triggerType":"request","id":"475a0f53f68c4332bbaed14f67f5fea1"}],"goals":[{"name":"Password Reset","trigger_id":"475a0f53f68c4332bbaed14f67f5fea1","nodes":[{"type":"StartGoal","goal_id":"3533cf8523a74364838053ee776ce78b","greeting_msg":{"type":"String","mode":"string","value":""},"id":"75aee04cc7954ba296c89bac3f14f02d","name":"Start"},{"type":"TerminateGoal","goal_id":"3533cf8523a74364838053ee776ce78b","confirmation_msg":{"type":"String","mode":"string","value":"gs.getMessage(\"Thanks for using our support chat! Have a great day!\")"},"id":"eefea10ec7e44595a7a97380499a652e","name":"End"},{"type":"ScriptedAction","script":"(function execute() {\n    vaVars.user_name = gs.getUserName();\n\t\tvaVars.is_authenticated = '' + (vaVars.user_name != 'guest');\n    return '';\n})()\n","id":"80263a6236994e6e9a367461388552b2","name":"Authentication","goal_id":"3533cf8523a74364838053ee776ce78b"},{"type":"Decision","name":"Decision","branches":[{"type":"Branch","label":"Authenticated","expression":{"type":"Applicability","mode":"script","value":"(function execute() {\n    return vaVars.is_authenticated == 'true';\n})()\n"},"id":"757cee063c39425387cf6b5ff79262f2","name":"Authenticated"},{"type":"Branch","label":"Not Authenticated","expression":{"type":"Applicability","mode":"script","value":"(function execute() {\n    return vaVars.is_authenticated == 'false';\n})()\n"},"id":"1b0919ec5ec7429590d2d434c6ac37b8","name":"Not Authenticated"}],"id":"14cc27fd094944388c1e025aefcc3fe6","goal_id":"3533cf8523a74364838053ee776ce78b"},{"type":"InputPrompt","variable_id":"011f4c38d24b4d8ab8962d11adb312ab","message":{"type":"String","mode":"string","value":"gs.getMessage(\"Please enter your email address.\")"},"optional":false,"id":"36bf755e6f894718a48ca7596585d9c6","name":"Email","goal_id":"3533cf8523a74364838053ee776ce78b"},{"type":"ScriptedAction","script":"(function execute() {\n\tvar gr = new GlideRecord('sys_user');\n\tgr.addActiveQuery();\n\tgr.addQuery('email', vaInputs.email);\n\tgr.query();\n\t\n\tvaVars.user_found = '' + gr.hasNext();\n\t\n    return '';\n})()\n","id":"bd3acfd68893404b9e417394fe35c6b3","name":"Find User","goal_id":"3533cf8523a74364838053ee776ce78b"},{"type":"Decision","name":"Decision","branches":[{"type":"Branch","label":"User Found","expression":{"type":"Applicability","mode":"script","value":"(function execute() {\n    return vaVars.user_found == 'true';\n})()\n"},"id":"cfbf5378919a4223b52c259932d98c9e","name":"User Found"},{"type":"Branch","label":"User Not Found","expression":{"type":"Applicability","mode":"script","value":"(function execute() {\n    return vaVars.user_found == 'false';\n})()\n"},"id":"40733df760a944468cb33271e109e8f9","name":"User Not Found"}],"id":"43f08d955f0347ba93fc1fcb643b5de3","goal_id":"3533cf8523a74364838053ee776ce78b"},{"type":"ScriptedAction","script":"(function execute() {\n\n    function getUser() {\n        if (vaVars.user_name == 'guest') {\n            var gr = new GlideRecord('sys_user');\n            gr.addQuery('email', vaInputs.email);\n            gr.query();\n            gr.next(); \n            return gr.getUniqueValue();\n        }\n        else \n            return vaInputs.user;\n    }\n\n    var gr = new GlideRecord('pwd_enrollment');\n\tgr.addQuery('user', getUser());\n\tgr.addQuery('status', 1);\n\tgr.query();\n\t\n\tvaVars.is_enrolled = '' + gr.hasNext();\n\n    return '';\n})()\n","id":"bfc84438108545f984d5905e04bcd730","name":"Check Enrollment","goal_id":"3533cf8523a74364838053ee776ce78b"},{"type":"InputPrompt","variable_id":"cf2a5b174a4f4ca8af3a27c733f70a16","message":{"type":"String","mode":"string","value":"gs.getMessage(\"I didn't find your email address. Would you like to enter another?\")"},"optional":false,"id":"fe22845302164aa49ac6adebf0fbd400","name":"Repeat Email","goal_id":"3533cf8523a74364838053ee776ce78b"},{"type":"Decision","name":"Decision","branches":[{"type":"Branch","label":"Enter Email Again","expression":{"type":"Applicability","mode":"script","value":"(function execute() {\n    return vaInputs.repeat_email.getValue();\n})()\n"},"id":"d6f80376179b42199a9b53682d71057f","name":"Enter Email Again"},{"type":"Branch","label":"Stop Entering Email","expression":{"type":"Applicability","mode":"script","value":"(function execute() {\n    return !vaInputs.repeat_email.getValue();;\n})()\n"},"id":"9a148a474eef437bb711bfb00e09aa69","name":"Stop Entering Email"}],"id":"4248ff983d284a709ef7475929f24be4","goal_id":"3533cf8523a74364838053ee776ce78b"},{"type":"Decision","name":"Decision","branches":[{"type":"Branch","label":"Enrolled","expression":{"type":"Applicability","mode":"script","value":"(function execute() {\n    return vaVars.is_enrolled == 'true';\n})()\n"},"id":"b51cee293439472d8090f9fb682a03e8","name":"Enrolled"},{"type":"Branch","label":"Not Enrolled","expression":{"type":"Applicability","mode":"script","value":"(function execute() {\n    return vaVars.is_enrolled == 'false';\n})()\n"},"id":"efcf9b435398490d9445bcbd977341ce","name":"Not Enrolled"}],"id":"41285588454e4526b203d700e7ae2923","goal_id":"3533cf8523a74364838053ee776ce78b"},{"type":"LinkOutputPrompt","header":{"type":"String","mode":"string","value":"gs.getMessage(\"Sorry, enrollment is required to reset your password. Click below to enroll.\")"},"label":{"type":"String","mode":"string","value":"gs.getMessage(\"Password Enrollment Link\")"},"url":{"type":"String","mode":"script","value":"(function execute() {\n    return gs.getProperty('glide.servlet.uri') + '/$pwd_enrollment_form_container.do';\n})()\n"},"id":"3e01d35c2a0a4611b08d654b8b969657","name":"Password Enrollment Link","goal_id":"3533cf8523a74364838053ee776ce78b"},{"type":"ScriptedAction","script":"(function execute() {\n    \n    function getUser() {\n        if (vaVars.user_name == 'guest') {\n            var gr = new GlideRecord('sys_user');\n            gr.addQuery('email', vaInputs.email);\n            gr.query();\n            gr.next(); \n            return gr.getUniqueValue();\n        }\n        else \n            return vaInputs.user;\n    }\n    \n    // Check if User is in a Password Process group\n    function checkIfUserIsInGroup(process, userId) {\n        var process_group = new GlideRecord('pwd_map_proc_to_group');\n        process_group.addQuery('process', process.getUniqueValue());\n        process_group.query();\n        \n        while(process_group.next()) {\n            var grmember = new GlideRecord('sys_user_grmember');\n            grmember.addQuery('user', userId);\n            grmember.addQuery('group', process_group.getValue('user_group'));\n            grmember.query();\n            \n            if(grmember.hasNext()) {\n                return true;\n            }\n        }\n        \n        return false;\n    }\n    \n    var gr = new GlideRecord('pwd_process');\n\tgr.addActiveQuery();\n\tgr.addQuery('public_access', true);\n\tgr.addQuery('enabled_on_chatbot', true);\n\tgr.query();\n\n    var results = [];\n    var index = 0;\n    var userId = getUser();\n    while(gr.next()) {\n        if (gr.getValue('apply_to_all_users') == '1' || checkIfUserIsInGroup(gr, userId)) {\n            results.push(\n                {\n                    'name': gr.getDisplayValue('name'),\n                    'value': '$pwd_reset.do?sysparm_url=' + gr.getValue('url_suffix')\n                }\n            )\n            index++;\n        }\n    }\n    vaVars.pwd_reset_links = JSON.stringify(results);\n\n    return '';\n})()\n","id":"16339e9dbacd4a06a77a778222c1c558","name":"Find Password Reset Links","goal_id":"3533cf8523a74364838053ee776ce78b"},{"type":"Decision","name":"Decision","branches":[{"type":"Branch","label":"Links Not Found","expression":{"type":"Applicability","mode":"script","value":"(function execute() {\n    var results = JSON.parse(vaVars.pwd_reset_links);\n    return results.length == 0;\n})()\n"},"id":"73cdd0404d0a40619629e87c4c5d1737","name":"Links Not Found"},{"type":"Branch","label":"Links Found","expression":{"type":"Applicability","mode":"script","value":"(function execute() {\n    var results = JSON.parse(vaVars.pwd_reset_links);\n    return results.length &gt; 0;\n})()\n"},"id":"160a15007c8f438fb9379fe129801fbd","name":"Links Found"}],"id":"2793555ce1a443af95bb391a39fabcb8","goal_id":"3533cf8523a74364838053ee776ce78b"},{"type":"LinkOutputPrompt","header":{"type":"String","mode":"script","value":"(function execute() {\n    var results = JSON.parse(vaVars.pwd_reset_links);\n    return results[parseInt(vaVars.pwd_reset_index)].name;\n})()\n"},"label":{"type":"String","mode":"string","value":"gs.getMessage(\"Reset your password.\")"},"url":{"type":"String","mode":"script","value":"(function execute() {\n    var results = JSON.parse(vaVars.pwd_reset_links);\n    var baseURL = gs.getProperty('glide.servlet.uri');\n    return baseURL + '/' + results[parseInt(vaVars.pwd_reset_index)].value;\n})()\n"},"id":"c51860b2442c48fc89d9215de8470702","name":"Password Reset Link","goal_id":"3533cf8523a74364838053ee776ce78b"},{"type":"ScriptedAction","script":"(function execute() {\n    vaVars.pwd_reset_index = parseInt(vaVars.pwd_reset_index) + 1;\n    return '';\n})()\n","id":"c722d60ac1a04242a56326ee526b832b","name":"Increment Counter","goal_id":"3533cf8523a74364838053ee776ce78b"},{"type":"Decision","name":"Decision","branches":[{"type":"Branch","label":"No links left","expression":{"type":"Applicability","mode":"script","value":"(function execute() {\n    var results = JSON.parse(vaVars.pwd_reset_links);\n    return parseInt(vaVars.pwd_reset_index) &gt;= results.length;\n})()\n"},"id":"ad50fdc6747e4438b67a7df6a306470b","name":"No links left"},{"type":"Branch","label":"Next link","expression":{"type":"Applicability","mode":"script","value":"(function execute() {\n    var results = JSON.parse(vaVars.pwd_reset_links);\n    return parseInt(vaVars.pwd_reset_index) &lt; results.length;\n})()\n"},"id":"0c9e4761b1c043349e5607c34fd6e7ba","name":"Next link"}],"id":"1414194e55334fa3bf952908ed3f2fab","goal_id":"3533cf8523a74364838053ee776ce78b"},{"type":"Decision","name":"Decision","branches":[{"type":"Branch","label":"Authenticated","expression":{"type":"Applicability","mode":"script","value":"(function execute() {\n    return vaVars.is_authenticated == 'true';;\n})()\n"},"id":"1ee7884df95d41bc91e374e9d3c6d909","name":"Authenticated"},{"type":"Branch","label":"Not Authenticated","expression":{"type":"Applicability","mode":"script","value":"(function execute() {\n    return vaVars.is_authenticated != 'true';\n})()\n"},"id":"38530ceda6ac4d5389ffd783e2d166bc","name":"Not Authenticated"}],"id":"4faf2e92d3f64a608895ad83336f6f58","goal_id":"3533cf8523a74364838053ee776ce78b"},{"type":"OutputPrompt","value":{"type":"String","mode":"string","value":"gs.getMessage(\"Sorry, I can't reset your password. Please contact the service desk for help.\")"},"id":"e1c7f94f941f49cf9c8d22ad0233e855","name":"Contact Support","goal_id":"3533cf8523a74364838053ee776ce78b"}],"edges":[{"type":"Edge","source_node_id":"2793555ce1a443af95bb391a39fabcb8","target_node_id":"e1c7f94f941f49cf9c8d22ad0233e855","branch_id":"73cdd0404d0a40619629e87c4c5d1737","id":"df9c6d7a1dcf4a9e9b89682ad6d71a27","name":"73cdd0404d0a40619629e87c4c5d1737"},{"type":"Edge","source_node_id":"3e01d35c2a0a4611b08d654b8b969657","target_node_id":"eefea10ec7e44595a7a97380499a652e","id":"a4a53d2f82f64475adb9937e66e35063"},{"type":"Edge","source_node_id":"75aee04cc7954ba296c89bac3f14f02d","target_node_id":"80263a6236994e6e9a367461388552b2","id":"cb2799f2cdbb4271a133f65e17635e80"},{"type":"Edge","source_node_id":"80263a6236994e6e9a367461388552b2","target_node_id":"14cc27fd094944388c1e025aefcc3fe6","id":"41e79a5bde894a26b49f59b4523ff710"},{"type":"Edge","source_node_id":"14cc27fd094944388c1e025aefcc3fe6","target_node_id":"bfc84438108545f984d5905e04bcd730","branch_id":"757cee063c39425387cf6b5ff79262f2","id":"a7c7f84ec3b14fd9a36ac1bcfaf57eac","name":"757cee063c39425387cf6b5ff79262f2"},{"type":"Edge","source_node_id":"14cc27fd094944388c1e025aefcc3fe6","target_node_id":"36bf755e6f894718a48ca7596585d9c6","branch_id":"1b0919ec5ec7429590d2d434c6ac37b8","id":"fee55e60d2064357915e08ef20c157c9","name":"1b0919ec5ec7429590d2d434c6ac37b8"},{"type":"Edge","source_node_id":"36bf755e6f894718a48ca7596585d9c6","target_node_id":"bd3acfd68893404b9e417394fe35c6b3","id":"268f44c210f64b5b967d4d39669c55db"},{"type":"Edge","source_node_id":"bd3acfd68893404b9e417394fe35c6b3","target_node_id":"43f08d955f0347ba93fc1fcb643b5de3","id":"79f85dc489e449dbb2fb6b9cddba869b"},{"type":"Edge","source_node_id":"43f08d955f0347ba93fc1fcb643b5de3","target_node_id":"bfc84438108545f984d5905e04bcd730","branch_id":"cfbf5378919a4223b52c259932d98c9e","id":"0939913200c345c29ba3bc7fa00f1d25","name":"cfbf5378919a4223b52c259932d98c9e"},{"type":"Edge","source_node_id":"43f08d955f0347ba93fc1fcb643b5de3","target_node_id":"fe22845302164aa49ac6adebf0fbd400","branch_id":"40733df760a944468cb33271e109e8f9","id":"528e87e6257b4f2d93b9e64311be21df","name":"40733df760a944468cb33271e109e8f9"},{"type":"Edge","source_node_id":"fe22845302164aa49ac6adebf0fbd400","target_node_id":"4248ff983d284a709ef7475929f24be4","id":"a049ce0aa0604feab440ef9b7d4fc68c"},{"type":"Edge","source_node_id":"4248ff983d284a709ef7475929f24be4","target_node_id":"36bf755e6f894718a48ca7596585d9c6","branch_id":"d6f80376179b42199a9b53682d71057f","id":"8069ead68a9e4d138ec8a506171791c6","name":"d6f80376179b42199a9b53682d71057f"},{"type":"Edge","source_node_id":"4248ff983d284a709ef7475929f24be4","target_node_id":"eefea10ec7e44595a7a97380499a652e","branch_id":"9a148a474eef437bb711bfb00e09aa69","id":"46a8af926c5d42d78880651bd43f672f","name":"9a148a474eef437bb711bfb00e09aa69"},{"type":"Edge","source_node_id":"bfc84438108545f984d5905e04bcd730","target_node_id":"41285588454e4526b203d700e7ae2923","id":"f9682f3120cd4a3680bd3a9fd881ca7f"},{"type":"Edge","source_node_id":"41285588454e4526b203d700e7ae2923","target_node_id":"16339e9dbacd4a06a77a778222c1c558","branch_id":"b51cee293439472d8090f9fb682a03e8","id":"8ff00c0549ea450f807c089a3d612961","name":"b51cee293439472d8090f9fb682a03e8"},{"type":"Edge","source_node_id":"16339e9dbacd4a06a77a778222c1c558","target_node_id":"2793555ce1a443af95bb391a39fabcb8","id":"517f104f594a4e179336fbeaaeadff97"},{"type":"Edge","source_node_id":"2793555ce1a443af95bb391a39fabcb8","target_node_id":"c51860b2442c48fc89d9215de8470702","branch_id":"160a15007c8f438fb9379fe129801fbd","id":"d3753cfcf5af4ecc832c39e00042908f","name":"160a15007c8f438fb9379fe129801fbd"},{"type":"Edge","source_node_id":"c51860b2442c48fc89d9215de8470702","target_node_id":"c722d60ac1a04242a56326ee526b832b","id":"8b37a22654a54845ace57ca93b379663"},{"type":"Edge","source_node_id":"c722d60ac1a04242a56326ee526b832b","target_node_id":"1414194e55334fa3bf952908ed3f2fab","id":"9eb560b1bbce4a1f8a75a7955ce44f21"},{"type":"Edge","source_node_id":"1414194e55334fa3bf952908ed3f2fab","target_node_id":"eefea10ec7e44595a7a97380499a652e","branch_id":"ad50fdc6747e4438b67a7df6a306470b","id":"e9e73d1897c74a929328e96a5a3a73a3","name":"ad50fdc6747e4438b67a7df6a306470b"},{"type":"Edge","source_node_id":"1414194e55334fa3bf952908ed3f2fab","target_node_id":"c51860b2442c48fc89d9215de8470702","branch_id":"0c9e4761b1c043349e5607c34fd6e7ba","id":"278b9d2e33e342dabc39dc31cdc06545","name":"0c9e4761b1c043349e5607c34fd6e7ba"},{"type":"Edge","source_node_id":"41285588454e4526b203d700e7ae2923","target_node_id":"4faf2e92d3f64a608895ad83336f6f58","branch_id":"efcf9b435398490d9445bcbd977341ce","id":"0f382a96c11a45b6bc47d4dc621de395","name":"efcf9b435398490d9445bcbd977341ce"},{"type":"Edge","source_node_id":"4faf2e92d3f64a608895ad83336f6f58","target_node_id":"3e01d35c2a0a4611b08d654b8b969657","branch_id":"1ee7884df95d41bc91e374e9d3c6d909","id":"9756874a41dc49cbb25c8c0668b35b3d","name":"1ee7884df95d41bc91e374e9d3c6d909"},{"type":"Edge","source_node_id":"4faf2e92d3f64a608895ad83336f6f58","target_node_id":"e1c7f94f941f49cf9c8d22ad0233e855","branch_id":"38530ceda6ac4d5389ffd783e2d166bc","id":"7f8611a0ba324bf8b72f5c140bfa3414","name":"38530ceda6ac4d5389ffd783e2d166bc"},{"type":"Edge","source_node_id":"e1c7f94f941f49cf9c8d22ad0233e855","target_node_id":"eefea10ec7e44595a7a97380499a652e","id":"dd5f14322f3141c98ef5a0f03a83d9da"}],"id":"3533cf8523a74364838053ee776ce78b"}],"script_variables":[{"type":"String","name":"is_authenticated","value":{"type":"String","mode":"string","value":"false"},"id":"c03b59507239434e8448dd26530fedd6"},{"type":"String","name":"is_enrolled","value":{"type":"String","mode":"string","value":"false"},"id":"7bcaf5b2df0b496d92b983a700565ba4"},{"type":"String","name":"user_found","value":{"type":"String","mode":"string","value":"false"},"id":"524500d5aaae465c9dc55b18db96514f"},{"type":"String","name":"pwd_reset_links","id":"5d981cb187584a77acaada72e3800842"},{"type":"String","name":"pwd_reset_index","value":{"type":"String","mode":"string","value":"0"},"id":"c6fb18a3d5274201acebe743651ffd7e"},{"type":"String","name":"user_name","value":{"type":"String","mode":"string"},"id":"0d3de7a9a3da441ab4071807771a2008"},{"type":"String","name":"LiveAgent_application","value":{"type":"String","mode":"string","value":"itsm"},"id":"528fb09d458e47218a51ca2f738af9eb"}],"glide_variables":[{"type":"String","name":"email","id":"011f4c38d24b4d8ab8962d11adb312ab"},{"type":"True/False","id":"cf2a5b174a4f4ca8af3a27c733f70a16","name":"repeat_email"}],"applicability":{"type":"Applicability","mode":"script","value":"(function execute() {\n    return !gs.hasRole('snc_external') || gs.hasRole('admin');\n})()\n"},"roles":["public"],"scope":"134450a0b3781300787162ac16a8dc1e","id":"27093a5edb741300cde2fd131d9619d5","name":"Get Password Reset Link","key_phrases":["locked out","password","forgot","reset"]}</design_definition>
        <design_topic_id>27093a5edb741300cde2fd131d9619d5</design_topic_id>
        <name>Get Password Reset Link</name>
        <sys_class_name>sys_cb_design_topic</sys_class_name>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2019-09-27 09:28:42</sys_created_on>
        <sys_domain>global</sys_domain>
        <sys_id>3a5b0f47db400010df58a3a948961957</sys_id>
        <sys_mod_count>0</sys_mod_count>
        <sys_name>FlowTopic</sys_name>
        <sys_package display_value="NeedIt" source="x_58872_needit">6ead8e780f603200cd674f8ce1050ed1</sys_package>
        <sys_policy/>
        <sys_scope display_value="NeedIt">6ead8e780f603200cd674f8ce1050ed1</sys_scope>
        <sys_update_name>sys_cb_design_topic_3a5b0f47db400010df58a3a948961957</sys_update_name>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2019-09-27 09:28:42</sys_updated_on>
        <type>FlowTopic</type>
    </sys_cb_design_topic>
</record_update>
