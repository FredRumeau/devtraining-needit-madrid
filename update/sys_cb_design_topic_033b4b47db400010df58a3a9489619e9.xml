<?xml version="1.0" encoding="UTF-8"?><record_update sys_domain="global" table="sys_cb_design_topic">
    <sys_cb_design_topic action="INSERT_OR_UPDATE">
        <compiled_topic display_value="System Status">473b4b47db400010df58a3a9489619e6</compiled_topic>
        <design_definition>{"type":"FlowTopic","triggers":[{"type":"Trigger","name":"7fdc3cebabb34670abb53424bec5c319","triggerType":"request","id":"7fdc3cebabb34670abb53424bec5c319"}],"goals":[{"name":"Outage Info","trigger_id":"7fdc3cebabb34670abb53424bec5c319","nodes":[{"type":"StartGoal","goal_id":"2c7aed2c2aab43f18636fe70981fd241","greeting_msg":{"type":"String","mode":"string","value":""},"id":"7eaea6d27e2c4ebdacc03745d7934fea","name":"Start"},{"type":"TerminateGoal","goal_id":"2c7aed2c2aab43f18636fe70981fd241","confirmation_msg":{"type":"String","mode":"string","value":"gs.getMessage(\"Thanks for using our support chat! Have a great day!\")"},"id":"1d63602e607647e888c51e9a7d2b17b8","name":"End"},{"type":"ReferenceChoiceInputPrompt","mode":"external","id":"fc28755cdb614417b6ec0b7463d28c79","name":"List Outages","goal_id":"2c7aed2c2aab43f18636fe70981fd241","variable_id":"feb374539d6349fb844e882a8c16caa1","message":{"type":"String","mode":"string","value":"Here are the known outages. Please select one for details, or select [I'm done] to exit."},"optional":false,"expression_mode":"script","script":"(function execute() {\n    var options = [];\n\n    // get variables\n    var index = parseInt(vaVars.index);\n    var limit = parseInt(vaVars.limit);\n    var count = 0;\n\n    // query current and future planned outages \n    var gr = new GlideRecord('cmdb_ci_outage');\n    gr.addEncodedQuery('begin&lt;=javascript:gs.endOfToday()^endISEMPTY^ORend&gt;javascript:gs.endOfToday()^NQtype=planned^beginRELATIVELE@dayofweek@ahead@7^end&gt;javascript:gs.endOfToday()');\n    gr.orderBy('begin');\n    gr.chooseWindow(index, index + limit, true);\n    gr.query();\n\n    // get total count, used for pagination\n    count = gr.getRowCount();\n    vaVars.count = count;\n\n    // page of outage records\n    var cnt = 0;\n    while(gr.next()) {\n        options.push({ 'value': gr.getUniqueValue(), 'label': gr.getDisplayValue('cmdb_ci') + ': ' + gr.getDisplayValue('type') });\n        cnt++;\n    }\n\n    var totalPages = Math.ceil(count / limit).toString();\n    var currentPage = Math.ceil((index+1) / limit).toString();\n\n    // previous and next buttons\n    if ( index &gt; 0 &amp;&amp; cnt &gt; 0 ) {\n        options.push({ 'value': 'prev', 'label': gs.getMessage('Show previous')});\n    }\n    if ( count &gt; index + limit ) {\n        options.push({ 'value': 'next', 'label': gs.getMessage('Show more')});\n    }\n    options.push({ 'value': 'cancel', 'label': gs.getMessage(\"I'm done\")});\n\n\n    return options;\n})()\n","no_options_found_message":{"type":"String","mode":"string","value":"Sorry, I had a problem finding outages. Let me try that again."},"condition":{"type":"Condition","mode":"external_script","value":"(function execute() {\n    var options = [];\n\n    // get variables\n    var index = parseInt(vaVars.index);\n    var limit = parseInt(vaVars.limit);\n    var count = 0;\n\n    // query current and future planned outages \n    var gr = new GlideRecord('cmdb_ci_outage');\n    gr.addEncodedQuery('begin&lt;=javascript:gs.endOfToday()^endISEMPTY^ORend&gt;javascript:gs.endOfToday()^NQtype=planned^beginRELATIVELE@dayofweek@ahead@7^end&gt;javascript:gs.endOfToday()');\n    gr.orderBy('begin');\n    gr.chooseWindow(index, index + limit, true);\n    gr.query();\n\n    // get total count, used for pagination\n    count = gr.getRowCount();\n    vaVars.count = count;\n\n    // page of outage records\n    var cnt = 0;\n    while(gr.next()) {\n        options.push({ 'value': gr.getUniqueValue(), 'label': gr.getDisplayValue('cmdb_ci') + ': ' + gr.getDisplayValue('type') });\n        cnt++;\n    }\n\n    var totalPages = Math.ceil(count / limit).toString();\n    var currentPage = Math.ceil((index+1) / limit).toString();\n\n    // previous and next buttons\n    if ( index &gt; 0 &amp;&amp; cnt &gt; 0 ) {\n        options.push({ 'value': 'prev', 'label': gs.getMessage('Show previous')});\n    }\n    if ( count &gt; index + limit ) {\n        options.push({ 'value': 'next', 'label': gs.getMessage('Show more')});\n    }\n    options.push({ 'value': 'cancel', 'label': gs.getMessage(\"I'm done\")});\n\n\n    return options;\n})()\n"},"table":"cmdb_ci_outage"},{"type":"Decision","name":"Continue","branches":[{"type":"Branch","label":"More","expression":{"type":"Applicability","mode":"script","value":"(function execute() {\n    return vaInputs.more_outages == 'more';\n})()\n"},"id":"15a7254c9d9c45e999cb3da0cbc4ba8b","name":"More"},{"type":"Branch","label":"Cancel","expression":{"type":"Applicability","mode":"script","value":"(function execute() {\n    return vaInputs.more_outages == 'cancel';\n})()\n"},"id":"a99d1c06d0f6409ab294059348a102f0","name":"Cancel"}],"id":"3981502c327b4198a14de50859662704","goal_id":"2c7aed2c2aab43f18636fe70981fd241"},{"type":"ChoiceInputPrompt","expression_mode":"simple","id":"6aea3b0bdf9345f29e546f2ca60e4244","name":"More outages","goal_id":"2c7aed2c2aab43f18636fe70981fd241","variable_id":"ac1e7e2b94e046f187c8ba67541e480e","message":{"type":"String","mode":"string","value":"gs.getMessage(\"Would you like to see the outages again?\")"},"optional":false},{"type":"Decision","name":"Next Page","branches":[{"type":"Branch","label":"Outage","expression":{"type":"Applicability","mode":"script","value":"(function execute() {\n    return vaInputs.list_outages.getValue() != 'next' &amp;&amp; vaInputs.list_outages.getValue() != 'prev' \n        &amp;&amp; vaInputs.list_outages.getValue() != 'cancel' &amp;&amp; vaInputs.list_outages.getValue() != '';\n})()\n"},"id":"5f94b436b8f34f19b95293b44bf6a49d","name":"Outage"},{"type":"Branch","label":"Next","expression":{"type":"Applicability","mode":"script","value":"(function execute() {\n    return vaInputs.list_outages == 'next';\n})()\n"},"id":"6e24dc8222874035a0d79420b36838a6","name":"Next"},{"type":"Branch","label":"Previous","expression":{"type":"Applicability","mode":"script","value":"(function execute() {\n    return vaInputs.list_outages.getValue() == 'prev';\n})()\n"},"id":"feab2b51975041a39284d5a049c7ec3b","name":"Previous"},{"type":"Branch","label":"Cancel","expression":{"type":"Applicability","mode":"script","value":"(function execute() {\n    return vaInputs.list_outages.getValue() == 'cancel';\n})()\n"},"id":"484b058335f748fca73b5935b9178dfb","name":"Cancel"}],"id":"cd1f6b2e068440f0bf8401f219d808c3","goal_id":"2c7aed2c2aab43f18636fe70981fd241"},{"type":"OutputPrompt","value":{"type":"String","mode":"script","value":"(function execute() {\n    var fields = ['type', 'duration', 'begin', 'end', 'details'];\n    var card = new global.VaRecordCardRenderer(true);\n\n    var msg = '';\n    var gr = new GlideRecord('cmdb_ci_outage');\n    if ( gr.get(vaInputs.list_outages) ) {\n        var data = card.createFields(fields, gr);\n        var affectedValue = gr.getDisplayValue('cmdb_ci');\n        var affectedSystem = card.createStaticField(gs.getMessage('Affected System'), affectedValue, null); //Change label text for CI to Affected System\n        data.unshift(affectedSystem);\n        msg = card.renderCard(null, data);\n    }\n    return msg;\n})()\n"},"id":"011ebb335d8f437b8775dd2a6a673512","name":"Display Outage","goal_id":"2c7aed2c2aab43f18636fe70981fd241"},{"type":"ScriptedAction","script":"(function execute() {\n\n    // query current and future planned outages to get the updated count\n    var gr = new GlideRecord('cmdb_ci_outage');\n    gr.addEncodedQuery('begin&lt;=javascript:gs.endOfToday()^endISEMPTY^ORend&gt;javascript:gs.endOfToday()^NQtype=planned^beginRELATIVELE@dayofweek@ahead@7^end&gt;javascript:gs.endOfToday()');\n    gr.orderBy('begin');\n    gr.chooseWindow(index, index + limit, true);\n    gr.query();\n\n    // get total count, to check for existence of next page\n    vaVars.count = gr.getRowCount();\n\n    // next page math\n    var count = parseInt(vaVars.count);\n    var index = parseInt(vaVars.index);\n    var limit = parseInt(vaVars.limit);\n    if ( index + limit &gt;= count )\n        vaVars.index = 0;\n    else\n        vaVars.index = index + limit;\n    return '';\n})()\n","id":"5c42baa5ae1f4199b86f31acff592704","name":"Next Page","goal_id":"2c7aed2c2aab43f18636fe70981fd241"},{"type":"ScriptedAction","script":"(function execute() {\n    var index = parseInt(vaVars.index);\n    var limit = parseInt(vaVars.limit);\n    var c = index - limit;\n    if ( c &lt; 0 ) c = 0;\n    vaVars.index = c;\n    return '';\n})()\n","id":"cbaa4f828189449d85221c28a95f4baf","name":"Previous Page","goal_id":"2c7aed2c2aab43f18636fe70981fd241"},{"type":"OutputPrompt","value":{"type":"String","mode":"string","value":"gs.getMessage(\"Great news, there are no known outages!\")"},"id":"64544a1418d2457789d5cd8d201f0328","name":"No outages","goal_id":"2c7aed2c2aab43f18636fe70981fd241"},{"type":"OutputPrompt","value":{"type":"String","mode":"string","value":"gs.getMessage(\"Currently, there is only one known outage.\")"},"id":"2309af1e0dda42a79754b2e962e117b3","name":"One Outage","goal_id":"2c7aed2c2aab43f18636fe70981fd241"},{"type":"ScriptedAction","script":"(function execute() {\n    // reset to first page\n    vaVars.index = 0;\n\n    // count how many outages there are\n    var count = 0;\n    var gr = new GlideAggregate('cmdb_ci_outage');\n    gr.addEncodedQuery('begin&lt;=javascript:gs.endOfToday()^endISEMPTY^ORend&gt;javascript:gs.endOfToday()^NQtype=planned^beginRELATIVELE@dayofweek@ahead@7^end&gt;javascript:gs.endOfToday()');\n    gr.addAggregate('COUNT');\n    gr.query();\n    if (gr.next())\n        count = gr.getAggregate('COUNT');\n    \n    // set count variable\n    vaVars.count = count;\n})()\n","id":"23ae032775dd46b8beac532e1d223e09","name":"Check Outages","goal_id":"2c7aed2c2aab43f18636fe70981fd241"},{"type":"Decision","name":"Count Decision","branches":[{"type":"Branch","label":"Many Outages","expression":{"type":"Applicability","mode":"script","value":"(function execute() {\n    return vaVars.count &gt; 1;\n})()"},"id":"97a6f856902b4af4ac48411385958f84","name":"Many Outages"},{"type":"Branch","label":"No Outages","expression":{"type":"Applicability","mode":"script","value":"(function execute() {\n    return vaVars.count == 0;\n})()\n"},"id":"4b77d33d7c11495f86b8a217c4abd0ce","name":"No Outages"},{"type":"Branch","label":"One Outage","expression":{"type":"Applicability","mode":"script","value":"(function execute() {\n    return vaVars.count == 1;\n})()\n"},"id":"9f2a00e62afb4051902bfd22559b0789","name":"One Outage"}],"id":"ce8be2d5eb824acf99642dca6883d613","goal_id":"2c7aed2c2aab43f18636fe70981fd241"},{"type":"OutputPrompt","value":{"type":"String","mode":"script","value":"(function execute() {\n\n    // query current and future planned outages \n    var gr = new GlideRecord('cmdb_ci_outage');\n    gr.addEncodedQuery('begin&lt;=javascript:gs.endOfToday()^endISEMPTY^ORend&gt;javascript:gs.endOfToday()^NQtype=planned^beginRELATIVELE@dayofweek@ahead@7^end&gt;javascript:gs.endOfToday()');\n    gr.orderBy('begin');\n    gr.setLimit(1);\n    gr.query();\n\n    // display the outage record\n    var msg = '';\n    while(gr.next()) {\n        var fields = ['type', 'duration', 'begin', 'end', 'details'];\n        var card = new global.VaRecordCardRenderer(true);\n\n        var data = card.createFields(fields, gr);\n        var affectedValue = gr.getDisplayValue('cmdb_ci');\n        var affectedSystem = card.createStaticField(gs.getMessage('Affected System'), affectedValue, null); //Change label text for CI to Affected System\n        data.unshift(affectedSystem);\n        \n        msg = card.renderCard(null, data);\n    }\n\n    return msg;\n})()\n"},"id":"2caa1f5d143a479687bf9d788d7439c8","name":"Display Single Outage","goal_id":"2c7aed2c2aab43f18636fe70981fd241"}],"edges":[{"type":"Edge","source_node_id":"64544a1418d2457789d5cd8d201f0328","target_node_id":"1d63602e607647e888c51e9a7d2b17b8","id":"fb46d4e38a064bd4a020baacb348ab7d"},{"type":"Edge","source_node_id":"011ebb335d8f437b8775dd2a6a673512","target_node_id":"6aea3b0bdf9345f29e546f2ca60e4244","id":"7ae45581f01a443381af3b67bcd6c956"},{"type":"Edge","source_node_id":"3981502c327b4198a14de50859662704","target_node_id":"23ae032775dd46b8beac532e1d223e09","branch_id":"15a7254c9d9c45e999cb3da0cbc4ba8b","id":"024b508fc521490c96008f598fe9512d","name":"15a7254c9d9c45e999cb3da0cbc4ba8b"},{"type":"Edge","source_node_id":"6aea3b0bdf9345f29e546f2ca60e4244","target_node_id":"3981502c327b4198a14de50859662704","id":"115d89f5dd2f4e2dacb2b79bf7599089"},{"type":"Edge","source_node_id":"fc28755cdb614417b6ec0b7463d28c79","target_node_id":"cd1f6b2e068440f0bf8401f219d808c3","id":"e376f86a9a7e4bdaa91a007203f89d4a"},{"type":"Edge","source_node_id":"cd1f6b2e068440f0bf8401f219d808c3","target_node_id":"011ebb335d8f437b8775dd2a6a673512","branch_id":"5f94b436b8f34f19b95293b44bf6a49d","id":"7d24887e2ca94644b8a071d8881d0a37","name":"5f94b436b8f34f19b95293b44bf6a49d"},{"type":"Edge","source_node_id":"cd1f6b2e068440f0bf8401f219d808c3","target_node_id":"5c42baa5ae1f4199b86f31acff592704","branch_id":"6e24dc8222874035a0d79420b36838a6","id":"f57e773cd7d749cca1e015fd1e03ba28","name":"6e24dc8222874035a0d79420b36838a6"},{"type":"Edge","source_node_id":"5c42baa5ae1f4199b86f31acff592704","target_node_id":"fc28755cdb614417b6ec0b7463d28c79","id":"3ed6c4301b354e8fb255e4e15fd1a050"},{"type":"Edge","source_node_id":"cd1f6b2e068440f0bf8401f219d808c3","target_node_id":"cbaa4f828189449d85221c28a95f4baf","branch_id":"feab2b51975041a39284d5a049c7ec3b","id":"3688613b514941c7ae273d871d45b1ca","name":"feab2b51975041a39284d5a049c7ec3b"},{"type":"Edge","source_node_id":"cbaa4f828189449d85221c28a95f4baf","target_node_id":"fc28755cdb614417b6ec0b7463d28c79","id":"ec188e093c1842318b3e6911e2f3b0c1"},{"type":"Edge","source_node_id":"7eaea6d27e2c4ebdacc03745d7934fea","target_node_id":"23ae032775dd46b8beac532e1d223e09","id":"0dbc0a89dbc54e5fb956aef819f1692b"},{"type":"Edge","source_node_id":"23ae032775dd46b8beac532e1d223e09","target_node_id":"ce8be2d5eb824acf99642dca6883d613","id":"da05d5c5dc6c4519a1436b7186f7240c"},{"type":"Edge","source_node_id":"ce8be2d5eb824acf99642dca6883d613","target_node_id":"fc28755cdb614417b6ec0b7463d28c79","branch_id":"97a6f856902b4af4ac48411385958f84","id":"6637f797d40b48f4b8d0e83f43c9d720","name":"97a6f856902b4af4ac48411385958f84"},{"type":"Edge","source_node_id":"ce8be2d5eb824acf99642dca6883d613","target_node_id":"64544a1418d2457789d5cd8d201f0328","branch_id":"4b77d33d7c11495f86b8a217c4abd0ce","id":"1a8d988bec484963934b1e9f4f72e741","name":"4b77d33d7c11495f86b8a217c4abd0ce"},{"type":"Edge","source_node_id":"ce8be2d5eb824acf99642dca6883d613","target_node_id":"2309af1e0dda42a79754b2e962e117b3","branch_id":"9f2a00e62afb4051902bfd22559b0789","id":"da9569080a49404cae67eb6c824ad4d1","name":"9f2a00e62afb4051902bfd22559b0789"},{"type":"Edge","source_node_id":"2309af1e0dda42a79754b2e962e117b3","target_node_id":"2caa1f5d143a479687bf9d788d7439c8","id":"12ff960509124c31a8d565c6dea3e5b3"},{"type":"Edge","source_node_id":"2caa1f5d143a479687bf9d788d7439c8","target_node_id":"1d63602e607647e888c51e9a7d2b17b8","id":"bc96f345808947368132ebe099df3592"},{"type":"Edge","source_node_id":"3981502c327b4198a14de50859662704","target_node_id":"1d63602e607647e888c51e9a7d2b17b8","branch_id":"a99d1c06d0f6409ab294059348a102f0","id":"f40ee73ba2a64314810c076988638a5b","name":"a99d1c06d0f6409ab294059348a102f0"},{"type":"Edge","source_node_id":"cd1f6b2e068440f0bf8401f219d808c3","target_node_id":"1d63602e607647e888c51e9a7d2b17b8","branch_id":"484b058335f748fca73b5935b9178dfb","id":"21617cb4ae5b4734ab5447bc0ca31873","name":"484b058335f748fca73b5935b9178dfb"}],"id":"2c7aed2c2aab43f18636fe70981fd241"}],"script_variables":[{"type":"String","name":"limit","value":{"type":"String","mode":"script","value":"5"},"id":"779afb88ec184bde8131feff718f9843"},{"type":"String","name":"index","value":{"type":"String","mode":"script","value":"0"},"id":"835b6c93ccc64d37b3765f433f77b58f"},{"type":"String","name":"count","value":{"type":"String","mode":"script","value":"0"},"id":"10c6f0ed864b45f1a5776dcf1f915664"},{"type":"String","name":"LiveAgent_application","value":{"type":"String","mode":"string","value":"itsm"},"id":"4e05edb424644bfc85eb01ca296c746b"}],"glide_variables":[{"type":"Reference","table":"cmdb_ci_outage","id":"526d4bddefed455dbdf6592fbcdfd648","name":"lookup_outages"},{"type":"Choice","choices":[],"id":"feb374539d6349fb844e882a8c16caa1","name":"list_outages","table":"cmdb_ci_outage"},{"type":"Choice","choices":[{"name":"Yes","element":"more"},{"name":"No","element":"cancel"}],"id":"ac1e7e2b94e046f187c8ba67541e480e","name":"more_outages"},{"type":"Reference","table":"","id":"2e376e53a64d43edb81ef8f6d1e3baca","name":"initialize"}],"roles":[],"scope":"134450a0b3781300787162ac16a8dc1e","id":"08f9f9f63b01130028fa456993efc444","name":"System Status","key_phrases":["down","outage","not working","maintenance","system status"]}</design_definition>
        <design_topic_id>08f9f9f63b01130028fa456993efc444</design_topic_id>
        <name>System Status</name>
        <sys_class_name>sys_cb_design_topic</sys_class_name>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2019-09-27 09:28:10</sys_created_on>
        <sys_domain>global</sys_domain>
        <sys_id>033b4b47db400010df58a3a9489619e9</sys_id>
        <sys_mod_count>0</sys_mod_count>
        <sys_name>FlowTopic</sys_name>
        <sys_package display_value="NeedIt" source="x_58872_needit">6ead8e780f603200cd674f8ce1050ed1</sys_package>
        <sys_policy/>
        <sys_scope display_value="NeedIt">6ead8e780f603200cd674f8ce1050ed1</sys_scope>
        <sys_update_name>sys_cb_design_topic_033b4b47db400010df58a3a9489619e9</sys_update_name>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2019-09-27 09:28:10</sys_updated_on>
        <type>FlowTopic</type>
    </sys_cb_design_topic>
</record_update>
